<style>
span[contentEditable] {
        cursor: pointer;
        background-color: #D0D0D0;
    }

[contentEditable].empty:before {
  color: gray;
  content: "Title";
}

[contentEditable].empty:focus:before {
  height: 1em;
  content: "|"; /* Erase that placeholder text again */
}

.mybrick {
  border: 1px solid black;
  width: 240px;
  min-height: 3em;
  float: left;

  /* Shadows */
  /* Firefox */
  -moz-box-shadow:5px 5px 7px rgba(33,33,33,1);
  /* Safari+Chrome */
  -webkit-box-shadow: 5px 5px 7px rgba(33,33,33,.7);
  /* Opera */
  box-shadow: 5px 5px 7px rgba(33,33,33,.7);
  
  background-color: rgba(255,220,30,1);
  
  margin-bottom: 16px;
}

h2 {
  display:block;
}
</style>

<!-- these should be automagically inserted resp. converted from static
     Javascript which is compiled from the templates -->
<!-- later -->
<script id="tmplItem" type="text/x-handlebars-template">
      <div class="mybrick masonry-brick" id="note-\{\{id}}" style="background-color: \{\{bgcolor}}">
          <input type="hidden" value="\{\{id}}" />
          <h2 class="\{\{#unless title}}empty\{\{/unless}}" contenteditable="true" onblur="updateModel(this)">\{\{title}}</h2>
          <div contenteditable="true" onblur="updateModel(this)">\{\{\{text}}}</div>
          <a href="#" onclick="archiveItem(note)">x</a>
          <a href="#" onclick="syncItem(note)">u</a>
          <span id="sync-\{\{id}}">sync</span>
          <span id="modified-\{\{id}}">\{\{modifiedAt}}</span>
      </div>
</script>

<script id="tmplItems" type="text/x-handlebars-template">
    \{\{#each notes}}
        \{\{> tmplItem note=this }}
    \{\{else}}
        <p>Nothing to see here</p>
    \{\{/each}}
</script>

<script>
// Compile all our templates, until we can do that statically
$('script[type="text/x-handlebars-template"').each(function(i, item) {
    //console.log([$(item).attr('id'), $(item).html()]);
    // We should unescape the template here, later
    var html = $(item).html();
    html = html.replace(/\\{/g, "{"); // Goddamn Text::Handlebars
    
    Handlebars.registerPartial($(item).attr('id'), html );
});

var html = $("#tmplItems").html();
html = html.replace(/\\{\\{/g, "{"+"{"); // Goddamn Text::Handlebars
var tmplItems = Handlebars.compile(html);
</script>

<div>
  <h2>Ideas</h2>
  <div>
    <div id="toolbar" style="display: block;">
      <a href="#" onclick="syncItems()">Sync</a>
      <form action="." method="POST" onsubmit="javascript:addTodo(); return false;">
        <input type="text" size="30" placeholder="add new note here">
        <input class="btn-primary" type="submit" value="add">
      </form>
    </div>
    <div id="items">
    </div>
  </div>
</div>

<button onclick="javascript:listItems(); return false;">fetch</button>
