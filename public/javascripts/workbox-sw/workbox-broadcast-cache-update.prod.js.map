{"version":3,"file":"workbox-broadcast-cache-update.prod.js","sources":["packages/workbox-broadcast-cache-update/_version.mjs","packages/workbox-broadcast-cache-update/messageTypes.mjs","packages/workbox-broadcast-cache-update/broadcastUpdate.mjs","packages/workbox-broadcast-cache-update/BroadcastCacheUpdate.mjs","packages/workbox-broadcast-cache-update/utils/responsesAreSame.mjs","packages/workbox-broadcast-cache-update/BroadcastCacheUpdatePlugin.mjs"],"sourcesContent":["try{self.workbox.v['workbox:broadcast-cache-update:3.0.0-alpha.1']=1;}catch(e){} // eslint-disable-line","/*\n Copyright 2016 Google Inc. All Rights Reserved.\n Licensed under the Apache License, Version 2.0 (the \"License\");\n you may not use this file except in compliance with the License.\n You may obtain a copy of the License at\n\n     http://www.apache.org/licenses/LICENSE-2.0\n\n Unless required by applicable law or agreed to in writing, software\n distributed under the License is distributed on an \"AS IS\" BASIS,\n WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n See the License for the specific language governing permissions and\n limitations under the License.\n*/\n\nimport './_version.mjs';\n\nexport default {\n  CACHE_UPDATED: 'CACHE_UPDATED',\n};\n","/*\n Copyright 2016 Google Inc. All Rights Reserved.\n Licensed under the Apache License, Version 2.0 (the \"License\");\n you may not use this file except in compliance with the License.\n You may obtain a copy of the License at\n\n     http://www.apache.org/licenses/LICENSE-2.0\n\n Unless required by applicable law or agreed to in writing, software\n distributed under the License is distributed on an \"AS IS\" BASIS,\n WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n See the License for the specific language governing permissions and\n limitations under the License.\n*/\n\nimport {assert} from 'workbox-core/_private/assert.mjs';\nimport messageTypes from './messageTypes.mjs';\nimport './_version.mjs';\n\n/**\n * You would not normally call this method directly; it's called automatically\n * by an instance of the {@link BroadcastCacheUpdate} class. It's exposed here\n * for the benefit of developers who would rather not use the full\n * `BroadcastCacheUpdate` implementation.\n *\n * Calling this will dispatch a message on the provided\n * {@link https://developers.google.com/web/updates/2016/09/broadcastchannel|Broadcast Channel}\n * to notify interested subscribers about a change to a cached resource.\n *\n * The message that's posted has a formation inspired by the\n * [Flux standard action](https://github.com/acdlite/flux-standard-action#introduction)\n * format like so:\n *\n * ```\n * {\n *   type: 'CACHE_UPDATED',\n *   meta: 'workbox-broadcast-cache-update',\n *   payload: {\n *     cacheName: 'the-cache-name',\n *     updatedUrl: 'https://example.com/'\n *   }\n * }\n * ```\n *\n * (Usage of [Flux](https://facebook.github.io/flux/) itself is not at\n * all required.)\n *\n * @param {BroadcastChannel} channel The `BroadcastChannel` to use.\n * @param {string} cacheName The name of the cache in which the updated\n *        `Response` was stored.\n * @param {string} url The URL associated with the updated `Response`.\n * @param {string} source A string identifying this library as the source\n *        of the update message.\n *\n * @memberof workbox.broadcastUpdate\n */\nconst broadcastUpdate = (channel, cacheName, url, source) => {\n  if (process.env.NODE_ENV !== 'production') {\n    assert.isInstance(channel, BroadcastChannel, {\n      moduleName: 'workbox-broadcast-cache-update',\n      className: '~',\n      funcName: 'broadcaseUpdate',\n      paramName: 'channel',\n    });\n    assert.isType(cacheName, 'string', {\n      moduleName: 'workbox-broadcast-cache-update',\n      className: '~',\n      funcName: 'broadcaseUpdate',\n      paramName: 'cacheName',\n    });\n    assert.isType(source, 'string', {\n      moduleName: 'workbox-broadcast-cache-update',\n      className: '~',\n      funcName: 'broadcaseUpdate',\n      paramName: 'source',\n    });\n    assert.isType(url, 'string', {\n      moduleName: 'workbox-broadcast-cache-update',\n      className: '~',\n      funcName: 'broadcaseUpdate',\n      paramName: 'url',\n    });\n  }\n\n  channel.postMessage({\n    type: messageTypes.CACHE_UPDATED,\n    meta: source,\n    payload: {\n      cacheName: cacheName,\n      updatedUrl: url,\n    },\n  });\n};\n\nexport {broadcastUpdate};\n","/*\n Copyright 2016 Google Inc. All Rights Reserved.\n Licensed under the Apache License, Version 2.0 (the \"License\");\n you may not use this file except in compliance with the License.\n You may obtain a copy of the License at\n\n     http://www.apache.org/licenses/LICENSE-2.0\n\n Unless required by applicable law or agreed to in writing, software\n distributed under the License is distributed on an \"AS IS\" BASIS,\n WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n See the License for the specific language governing permissions and\n limitations under the License.\n*/\n\nimport {WorkboxError} from 'workbox-core/_private/WorkboxError.mjs';\nimport {responsesAreSame} from './utils/responsesAreSame.mjs';\nimport {broadcastUpdate} from './broadcastUpdate.mjs';\nimport './_version.mjs';\n\n/**\n * Uses the [Broadcast Channel API]{@link https://developers.google.com/web/updates/2016/09/broadcastchannel}\n * to notify interested parties when a cached response has been updated.\n *\n * For efficiency's sake, the underlying response bodies are not compared;\n * only specific response headers are checked.\n *\n * @memberof workbox.broadcastUpdate\n */\nclass BroadcastCacheUpdate {\n  /**\n   * Construct a BroadcastCacheUpdate instance with a specific `channelName` to\n   * broadcast messages on\n   *\n   * @param {string} channelName The name that will be used when creating\n   * the `BroadcastChannel`.\n   * @param {Object} options\n   * @param {Array<string>}\n   * [options.headersToCheck=['content-length', 'etag', 'last-modified']] A\n   * list of headers that will be used to determine whether the responses\n   * differ.\n   * @param {string} [options.source='workbox-broadcast-cache-update'] An\n   * attribution value that indicates where the update originated.\n   */\n  constructor(channelName, {headersToCheck, source} = {}) {\n    if (process.env.NODE_ENV !== 'production') {\n      if (typeof channelName !== 'string' || channelName.length === 0) {\n        throw new WorkboxError('channel-name-required');\n      }\n    }\n\n    this._channelName = channelName;\n    this._headersToCheck = headersToCheck || [\n      'content-length',\n      'etag',\n      'last-modified',\n    ];\n    this._source = source || 'workbox-broadcast-cache-update';\n\n    // TODO assert typeof headersToCheck instanceof Array\n  }\n\n  /**\n   * @return {BroadcastChannel} The BroadcastChannel instance used for\n   * broadcasting updates.\n   *\n   * @private\n   */\n  _getChannel() {\n    if (!this._channel) {\n      this._channel = new BroadcastChannel(this._channelName);\n    }\n    return this._channel;\n  }\n\n  /**\n   * Compare two [Responses](https://developer.mozilla.org/en-US/docs/Web/API/Response)\n   * and send a message via the\n   * {@link https://developers.google.com/web/updates/2016/09/broadcastchannel|Broadcast Channel API}\n   * if they differ.\n   *\n   * Neither of the Responses can be {@link http://stackoverflow.com/questions/39109789|opaque}.\n   *\n   * @param {Response} firstResponse First responses to compare.\n   * @param {Response} secondResponse Second responses to compare.\n   * @param {string} url The URL of the updated request.\n   * @param {string} cacheName Name of the cache the responses belong to.\n   * This is included in the message posted on the broadcast channel.\n   */\n  notifyIfUpdated(firstResponse, secondResponse, url, cacheName) {\n    // TODO: Move to assert\n    // isType({cacheName}, 'string');\n\n    if (!responsesAreSame(\n      firstResponse, secondResponse, this._headersToCheck)) {\n      broadcastUpdate(this._getChannel(), cacheName, url, this._source);\n    }\n  }\n}\n\nexport {BroadcastCacheUpdate};\n","/*\n Copyright 2016 Google Inc. All Rights Reserved.\n Licensed under the Apache License, Version 2.0 (the \"License\");\n you may not use this file except in compliance with the License.\n You may obtain a copy of the License at\n\n     http://www.apache.org/licenses/LICENSE-2.0\n\n Unless required by applicable law or agreed to in writing, software\n distributed under the License is distributed on an \"AS IS\" BASIS,\n WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n See the License for the specific language governing permissions and\n limitations under the License.\n*/\n\nimport {WorkboxError} from 'workbox-core/_private/WorkboxError.mjs';\nimport {logger} from 'workbox-core/_private/logger.mjs';\nimport '../_version.mjs';\n\n/**\n * Given two `Response's`, compares several header values to see if they are\n * the same or not.\n *\n * @param {Response} firstResponse\n * @param {Response} secondResponse\n * @param {Array<string>} headersToCheck\n * @return {boolean}\n *\n * @memberof workbox.broadcastUpdate\n * @private\n */\nconst responsesAreSame = (firstResponse, secondResponse, headersToCheck) => {\n  if (process.env.NODE_ENV !== 'production') {\n    if (!(firstResponse instanceof Response &&\n      secondResponse instanceof Response)) {\n      throw new WorkboxError('invalid-responses-are-same-args');\n    }\n  }\n\n  const atLeastOneHeaderAvailable = headersToCheck.some((header) => {\n    return firstResponse.headers.has(header) &&\n      secondResponse.headers.has(header);\n  });\n\n  if (!atLeastOneHeaderAvailable) {\n    if (process.env.NODE_ENV !== 'production') {\n      logger.warn(`Unable to determine where the response has been updated ` +\n        `because none of the headers that would be checked are present.`);\n      logger.debug(`Attempting to compare the following: `,\n        firstResponse, secondResponse, headersToCheck);\n    }\n\n    // Just return true, indicating the that responses are the same, since we\n    // can't determine otherwise.\n    return true;\n  }\n\n  return headersToCheck.every((header) => {\n    const headerStateComparison = firstResponse.headers.has(header) ===\n      secondResponse.headers.has(header);\n    const headerValueComparison = firstResponse.headers.get(header) ===\n      secondResponse.headers.get(header);\n\n    return headerStateComparison && headerValueComparison;\n  });\n};\n\nexport {responsesAreSame};\n","/*\n Copyright 2016 Google Inc. All Rights Reserved.\n Licensed under the Apache License, Version 2.0 (the \"License\");\n you may not use this file except in compliance with the License.\n You may obtain a copy of the License at\n\n     http://www.apache.org/licenses/LICENSE-2.0\n\n Unless required by applicable law or agreed to in writing, software\n distributed under the License is distributed on an \"AS IS\" BASIS,\n WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n See the License for the specific language governing permissions and\n limitations under the License.\n*/\n\nimport {assert} from 'workbox-core/_private/assert.mjs';\nimport {BroadcastCacheUpdate} from './BroadcastCacheUpdate.mjs';\nimport './_version.mjs';\n\n/**\n * This plugin will automatically broadcast a message whenever a cached response\n * is updated.\n *\n * @memberof workbox.broadcastUpdate\n */\nclass BroadcastCacheUpdatePlugin {\n    /**\n   * Construct a new instance with a specific `channelName` to\n   * broadcast messages on\n   *\n   * @param {string} channelName The name that will be used when creating\n   * the `BroadcastChannel`.\n   * @param {Object} options\n   * @param {Array<string>}\n   * [options.headersToCheck=['content-length', 'etag', 'last-modified']] A\n   * list of headers that will be used to determine whether the responses\n   * differ.\n   * @param {string} [options.source='workbox-broadcast-cache-update'] An\n   * attribution value that indicates where the update originated.\n   */\n  constructor(channelName, options) {\n    this._broadcastUpdate = new BroadcastCacheUpdate(channelName, options);\n  }\n  /**\n   * A \"lifecycle\" callback that will be triggered automatically by the\n   * `workbox-sw` and `workbox-runtime-caching` handlers when an entry is\n   * added to a cache.\n   *\n   * @private\n   * @param {Object} input The input object to this function.\n   * @param {string} input.cacheName Name of the cache the responses belong to.\n   * @param {Response} [input.oldResponse] The previous cached value, if any.\n   * @param {Response} input.newResponse The new value in the cache.\n   * @param {string} input.url The cache key URL.\n   */\n  cacheDidUpdate({cacheName, oldResponse, newResponse, url}) {\n    if (process.env.NODE_ENV !== 'production') {\n      assert.isType(cacheName, 'string', {\n        moduleName: 'workbox-broadcast-cache-update',\n        className: 'BroadcastCacheUpdatePlugin',\n        funcName: 'constructor',\n        paramName: 'cacheName',\n      });\n      assert.isInstance(newResponse, Response, {\n        moduleName: 'workbox-broadcast-cache-update',\n        className: 'BroadcastCacheUpdatePlugin',\n        funcName: 'constructor',\n        paramName: 'newResponse',\n      });\n    }\n\n    if (!oldResponse) {\n      // Without a two responses there is nothing to comapre\n      return;\n    }\n\n    this._broadcastUpdate\n      .notifyIfUpdated(oldResponse, newResponse, cacheName, url);\n  }\n}\n\nexport {BroadcastCacheUpdatePlugin};\n"],"names":["workbox","v","e","broadcastUpdate","channel","cacheName","url","source","postMessage","messageTypes","CACHE_UPDATED","BroadcastCacheUpdate","channelName","headersToCheck","_channelName","_headersToCheck","_source","this","_channel","BroadcastChannel","firstResponse","secondResponse","some","header","headers","has","every","headerStateComparison","headerValueComparison","get","responsesAreSame","_getChannel","BroadcastCacheUpdatePlugin","options","_broadcastUpdate","oldResponse","newResponse","notifyIfUpdated"],"mappings":"oFAAA,SAASA,QAAQC,EAAE,gDAAgD,EAAG,MAAMC,ICe5E,qBAGiB,iBCsCjB,MAAMC,EAAkB,CAACC,EAASC,EAAWC,EAAKC,OA4BxCC,kBACAC,EAAaC,mBACbH,qBAEOF,aACCC,YC5DZK,cAeQC,GAAaC,eAACA,EAADN,OAAiBA,YAOnCO,EAAeF,OACfG,EAAkBF,IACrB,iBACA,OACA,sBAEGG,EAAUT,GAAU,4CAYpBU,KAAKC,SACHA,EAAW,IAAIC,iBAAiBF,KAAKH,IAErCG,KAAKC,kBAiBEE,EAAeC,EAAgBf,EAAKD,GC1D7B,EAACe,EAAeC,EAAgBR,KAQrBA,EAAeS,KAAMC,GAC9CH,EAAcI,QAAQC,IAAIF,IAC/BF,EAAeG,QAAQC,IAAIF,KAgBxBV,EAAea,MAAOH,UACrBI,EAAwBP,EAAcI,QAAQC,IAAIF,KACtDF,EAAeG,QAAQC,IAAIF,GACvBK,EAAwBR,EAAcI,QAAQK,IAAIN,KACtDF,EAAeG,QAAQK,IAAIN,UAEtBI,GAAyBC,ID8B3BE,CACHV,EAAeC,EAAgBJ,KAAKF,MACpBE,KAAKc,IAAe1B,EAAWC,EAAKW,KAAKD,UEtEzDgB,cAeQpB,EAAaqB,QAClBC,EAAmB,IAAIvB,EAAqBC,EAAaqB,mBAcjD5B,UAACA,EAAD8B,YAAYA,EAAZC,YAAyBA,EAAzB9B,IAAsCA,IAgB9C6B,QAKAD,EACFG,gBAAgBF,EAAaC,EAAa/B,EAAWC","preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjpudWxsLCJzb3VyY2VzIjpbIi9Vc2Vycy9tYXR0Z2F1bnQvUHJvamVjdHMvQ29kZS93b3JrYm94L2dlbmVyYXRlZC1yZWxlYXNlLWZpbGVzL3YzLjAuMC1hbHBoYS4xL3NvdXJjZS1jb2RlL3BhY2thZ2VzL3dvcmtib3gtYnJvYWRjYXN0LWNhY2hlLXVwZGF0ZS9fdmVyc2lvbi5tanMiLCIvVXNlcnMvbWF0dGdhdW50L1Byb2plY3RzL0NvZGUvd29ya2JveC9nZW5lcmF0ZWQtcmVsZWFzZS1maWxlcy92My4wLjAtYWxwaGEuMS9zb3VyY2UtY29kZS9wYWNrYWdlcy93b3JrYm94LWJyb2FkY2FzdC1jYWNoZS11cGRhdGUvbWVzc2FnZVR5cGVzLm1qcyIsIi9Vc2Vycy9tYXR0Z2F1bnQvUHJvamVjdHMvQ29kZS93b3JrYm94L2dlbmVyYXRlZC1yZWxlYXNlLWZpbGVzL3YzLjAuMC1hbHBoYS4xL3NvdXJjZS1jb2RlL3BhY2thZ2VzL3dvcmtib3gtYnJvYWRjYXN0LWNhY2hlLXVwZGF0ZS9icm9hZGNhc3RVcGRhdGUubWpzIiwiL1VzZXJzL21hdHRnYXVudC9Qcm9qZWN0cy9Db2RlL3dvcmtib3gvZ2VuZXJhdGVkLXJlbGVhc2UtZmlsZXMvdjMuMC4wLWFscGhhLjEvc291cmNlLWNvZGUvcGFja2FnZXMvd29ya2JveC1icm9hZGNhc3QtY2FjaGUtdXBkYXRlL0Jyb2FkY2FzdENhY2hlVXBkYXRlLm1qcyIsIi9Vc2Vycy9tYXR0Z2F1bnQvUHJvamVjdHMvQ29kZS93b3JrYm94L2dlbmVyYXRlZC1yZWxlYXNlLWZpbGVzL3YzLjAuMC1hbHBoYS4xL3NvdXJjZS1jb2RlL3BhY2thZ2VzL3dvcmtib3gtYnJvYWRjYXN0LWNhY2hlLXVwZGF0ZS91dGlscy9yZXNwb25zZXNBcmVTYW1lLm1qcyIsIi9Vc2Vycy9tYXR0Z2F1bnQvUHJvamVjdHMvQ29kZS93b3JrYm94L2dlbmVyYXRlZC1yZWxlYXNlLWZpbGVzL3YzLjAuMC1hbHBoYS4xL3NvdXJjZS1jb2RlL3BhY2thZ2VzL3dvcmtib3gtYnJvYWRjYXN0LWNhY2hlLXVwZGF0ZS9Ccm9hZGNhc3RDYWNoZVVwZGF0ZVBsdWdpbi5tanMiXSwic291cmNlc0NvbnRlbnQiOlsidHJ5e3NlbGYud29ya2JveC52Wyd3b3JrYm94OmJyb2FkY2FzdC1jYWNoZS11cGRhdGU6My4wLjAtYWxwaGEuMSddPTE7fWNhdGNoKGUpe30gLy8gZXNsaW50LWRpc2FibGUtbGluZSIsIi8qXG4gQ29weXJpZ2h0IDIwMTYgR29vZ2xlIEluYy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcblxuICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcblxuIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuKi9cblxuaW1wb3J0ICcuL192ZXJzaW9uLm1qcyc7XG5cbmV4cG9ydCBkZWZhdWx0IHtcbiAgQ0FDSEVfVVBEQVRFRDogJ0NBQ0hFX1VQREFURUQnLFxufTtcbiIsIi8qXG4gQ29weXJpZ2h0IDIwMTYgR29vZ2xlIEluYy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcblxuICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcblxuIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuKi9cblxuaW1wb3J0IHthc3NlcnR9IGZyb20gJ3dvcmtib3gtY29yZS9fcHJpdmF0ZS9hc3NlcnQubWpzJztcbmltcG9ydCBtZXNzYWdlVHlwZXMgZnJvbSAnLi9tZXNzYWdlVHlwZXMubWpzJztcbmltcG9ydCAnLi9fdmVyc2lvbi5tanMnO1xuXG4vKipcbiAqIFlvdSB3b3VsZCBub3Qgbm9ybWFsbHkgY2FsbCB0aGlzIG1ldGhvZCBkaXJlY3RseTsgaXQncyBjYWxsZWQgYXV0b21hdGljYWxseVxuICogYnkgYW4gaW5zdGFuY2Ugb2YgdGhlIHtAbGluayBCcm9hZGNhc3RDYWNoZVVwZGF0ZX0gY2xhc3MuIEl0J3MgZXhwb3NlZCBoZXJlXG4gKiBmb3IgdGhlIGJlbmVmaXQgb2YgZGV2ZWxvcGVycyB3aG8gd291bGQgcmF0aGVyIG5vdCB1c2UgdGhlIGZ1bGxcbiAqIGBCcm9hZGNhc3RDYWNoZVVwZGF0ZWAgaW1wbGVtZW50YXRpb24uXG4gKlxuICogQ2FsbGluZyB0aGlzIHdpbGwgZGlzcGF0Y2ggYSBtZXNzYWdlIG9uIHRoZSBwcm92aWRlZFxuICoge0BsaW5rIGh0dHBzOi8vZGV2ZWxvcGVycy5nb29nbGUuY29tL3dlYi91cGRhdGVzLzIwMTYvMDkvYnJvYWRjYXN0Y2hhbm5lbHxCcm9hZGNhc3QgQ2hhbm5lbH1cbiAqIHRvIG5vdGlmeSBpbnRlcmVzdGVkIHN1YnNjcmliZXJzIGFib3V0IGEgY2hhbmdlIHRvIGEgY2FjaGVkIHJlc291cmNlLlxuICpcbiAqIFRoZSBtZXNzYWdlIHRoYXQncyBwb3N0ZWQgaGFzIGEgZm9ybWF0aW9uIGluc3BpcmVkIGJ5IHRoZVxuICogW0ZsdXggc3RhbmRhcmQgYWN0aW9uXShodHRwczovL2dpdGh1Yi5jb20vYWNkbGl0ZS9mbHV4LXN0YW5kYXJkLWFjdGlvbiNpbnRyb2R1Y3Rpb24pXG4gKiBmb3JtYXQgbGlrZSBzbzpcbiAqXG4gKiBgYGBcbiAqIHtcbiAqICAgdHlwZTogJ0NBQ0hFX1VQREFURUQnLFxuICogICBtZXRhOiAnd29ya2JveC1icm9hZGNhc3QtY2FjaGUtdXBkYXRlJyxcbiAqICAgcGF5bG9hZDoge1xuICogICAgIGNhY2hlTmFtZTogJ3RoZS1jYWNoZS1uYW1lJyxcbiAqICAgICB1cGRhdGVkVXJsOiAnaHR0cHM6Ly9leGFtcGxlLmNvbS8nXG4gKiAgIH1cbiAqIH1cbiAqIGBgYFxuICpcbiAqIChVc2FnZSBvZiBbRmx1eF0oaHR0cHM6Ly9mYWNlYm9vay5naXRodWIuaW8vZmx1eC8pIGl0c2VsZiBpcyBub3QgYXRcbiAqIGFsbCByZXF1aXJlZC4pXG4gKlxuICogQHBhcmFtIHtCcm9hZGNhc3RDaGFubmVsfSBjaGFubmVsIFRoZSBgQnJvYWRjYXN0Q2hhbm5lbGAgdG8gdXNlLlxuICogQHBhcmFtIHtzdHJpbmd9IGNhY2hlTmFtZSBUaGUgbmFtZSBvZiB0aGUgY2FjaGUgaW4gd2hpY2ggdGhlIHVwZGF0ZWRcbiAqICAgICAgICBgUmVzcG9uc2VgIHdhcyBzdG9yZWQuXG4gKiBAcGFyYW0ge3N0cmluZ30gdXJsIFRoZSBVUkwgYXNzb2NpYXRlZCB3aXRoIHRoZSB1cGRhdGVkIGBSZXNwb25zZWAuXG4gKiBAcGFyYW0ge3N0cmluZ30gc291cmNlIEEgc3RyaW5nIGlkZW50aWZ5aW5nIHRoaXMgbGlicmFyeSBhcyB0aGUgc291cmNlXG4gKiAgICAgICAgb2YgdGhlIHVwZGF0ZSBtZXNzYWdlLlxuICpcbiAqIEBtZW1iZXJvZiB3b3JrYm94LmJyb2FkY2FzdFVwZGF0ZVxuICovXG5jb25zdCBicm9hZGNhc3RVcGRhdGUgPSAoY2hhbm5lbCwgY2FjaGVOYW1lLCB1cmwsIHNvdXJjZSkgPT4ge1xuICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykge1xuICAgIGFzc2VydC5pc0luc3RhbmNlKGNoYW5uZWwsIEJyb2FkY2FzdENoYW5uZWwsIHtcbiAgICAgIG1vZHVsZU5hbWU6ICd3b3JrYm94LWJyb2FkY2FzdC1jYWNoZS11cGRhdGUnLFxuICAgICAgY2xhc3NOYW1lOiAnficsXG4gICAgICBmdW5jTmFtZTogJ2Jyb2FkY2FzZVVwZGF0ZScsXG4gICAgICBwYXJhbU5hbWU6ICdjaGFubmVsJyxcbiAgICB9KTtcbiAgICBhc3NlcnQuaXNUeXBlKGNhY2hlTmFtZSwgJ3N0cmluZycsIHtcbiAgICAgIG1vZHVsZU5hbWU6ICd3b3JrYm94LWJyb2FkY2FzdC1jYWNoZS11cGRhdGUnLFxuICAgICAgY2xhc3NOYW1lOiAnficsXG4gICAgICBmdW5jTmFtZTogJ2Jyb2FkY2FzZVVwZGF0ZScsXG4gICAgICBwYXJhbU5hbWU6ICdjYWNoZU5hbWUnLFxuICAgIH0pO1xuICAgIGFzc2VydC5pc1R5cGUoc291cmNlLCAnc3RyaW5nJywge1xuICAgICAgbW9kdWxlTmFtZTogJ3dvcmtib3gtYnJvYWRjYXN0LWNhY2hlLXVwZGF0ZScsXG4gICAgICBjbGFzc05hbWU6ICd+JyxcbiAgICAgIGZ1bmNOYW1lOiAnYnJvYWRjYXNlVXBkYXRlJyxcbiAgICAgIHBhcmFtTmFtZTogJ3NvdXJjZScsXG4gICAgfSk7XG4gICAgYXNzZXJ0LmlzVHlwZSh1cmwsICdzdHJpbmcnLCB7XG4gICAgICBtb2R1bGVOYW1lOiAnd29ya2JveC1icm9hZGNhc3QtY2FjaGUtdXBkYXRlJyxcbiAgICAgIGNsYXNzTmFtZTogJ34nLFxuICAgICAgZnVuY05hbWU6ICdicm9hZGNhc2VVcGRhdGUnLFxuICAgICAgcGFyYW1OYW1lOiAndXJsJyxcbiAgICB9KTtcbiAgfVxuXG4gIGNoYW5uZWwucG9zdE1lc3NhZ2Uoe1xuICAgIHR5cGU6IG1lc3NhZ2VUeXBlcy5DQUNIRV9VUERBVEVELFxuICAgIG1ldGE6IHNvdXJjZSxcbiAgICBwYXlsb2FkOiB7XG4gICAgICBjYWNoZU5hbWU6IGNhY2hlTmFtZSxcbiAgICAgIHVwZGF0ZWRVcmw6IHVybCxcbiAgICB9LFxuICB9KTtcbn07XG5cbmV4cG9ydCB7YnJvYWRjYXN0VXBkYXRlfTtcbiIsIi8qXG4gQ29weXJpZ2h0IDIwMTYgR29vZ2xlIEluYy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcblxuICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcblxuIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuKi9cblxuaW1wb3J0IHtXb3JrYm94RXJyb3J9IGZyb20gJ3dvcmtib3gtY29yZS9fcHJpdmF0ZS9Xb3JrYm94RXJyb3IubWpzJztcbmltcG9ydCB7cmVzcG9uc2VzQXJlU2FtZX0gZnJvbSAnLi91dGlscy9yZXNwb25zZXNBcmVTYW1lLm1qcyc7XG5pbXBvcnQge2Jyb2FkY2FzdFVwZGF0ZX0gZnJvbSAnLi9icm9hZGNhc3RVcGRhdGUubWpzJztcbmltcG9ydCAnLi9fdmVyc2lvbi5tanMnO1xuXG4vKipcbiAqIFVzZXMgdGhlIFtCcm9hZGNhc3QgQ2hhbm5lbCBBUElde0BsaW5rIGh0dHBzOi8vZGV2ZWxvcGVycy5nb29nbGUuY29tL3dlYi91cGRhdGVzLzIwMTYvMDkvYnJvYWRjYXN0Y2hhbm5lbH1cbiAqIHRvIG5vdGlmeSBpbnRlcmVzdGVkIHBhcnRpZXMgd2hlbiBhIGNhY2hlZCByZXNwb25zZSBoYXMgYmVlbiB1cGRhdGVkLlxuICpcbiAqIEZvciBlZmZpY2llbmN5J3Mgc2FrZSwgdGhlIHVuZGVybHlpbmcgcmVzcG9uc2UgYm9kaWVzIGFyZSBub3QgY29tcGFyZWQ7XG4gKiBvbmx5IHNwZWNpZmljIHJlc3BvbnNlIGhlYWRlcnMgYXJlIGNoZWNrZWQuXG4gKlxuICogQG1lbWJlcm9mIHdvcmtib3guYnJvYWRjYXN0VXBkYXRlXG4gKi9cbmNsYXNzIEJyb2FkY2FzdENhY2hlVXBkYXRlIHtcbiAgLyoqXG4gICAqIENvbnN0cnVjdCBhIEJyb2FkY2FzdENhY2hlVXBkYXRlIGluc3RhbmNlIHdpdGggYSBzcGVjaWZpYyBgY2hhbm5lbE5hbWVgIHRvXG4gICAqIGJyb2FkY2FzdCBtZXNzYWdlcyBvblxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gY2hhbm5lbE5hbWUgVGhlIG5hbWUgdGhhdCB3aWxsIGJlIHVzZWQgd2hlbiBjcmVhdGluZ1xuICAgKiB0aGUgYEJyb2FkY2FzdENoYW5uZWxgLlxuICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9uc1xuICAgKiBAcGFyYW0ge0FycmF5PHN0cmluZz59XG4gICAqIFtvcHRpb25zLmhlYWRlcnNUb0NoZWNrPVsnY29udGVudC1sZW5ndGgnLCAnZXRhZycsICdsYXN0LW1vZGlmaWVkJ11dIEFcbiAgICogbGlzdCBvZiBoZWFkZXJzIHRoYXQgd2lsbCBiZSB1c2VkIHRvIGRldGVybWluZSB3aGV0aGVyIHRoZSByZXNwb25zZXNcbiAgICogZGlmZmVyLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gW29wdGlvbnMuc291cmNlPSd3b3JrYm94LWJyb2FkY2FzdC1jYWNoZS11cGRhdGUnXSBBblxuICAgKiBhdHRyaWJ1dGlvbiB2YWx1ZSB0aGF0IGluZGljYXRlcyB3aGVyZSB0aGUgdXBkYXRlIG9yaWdpbmF0ZWQuXG4gICAqL1xuICBjb25zdHJ1Y3RvcihjaGFubmVsTmFtZSwge2hlYWRlcnNUb0NoZWNrLCBzb3VyY2V9ID0ge30pIHtcbiAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykge1xuICAgICAgaWYgKHR5cGVvZiBjaGFubmVsTmFtZSAhPT0gJ3N0cmluZycgfHwgY2hhbm5lbE5hbWUubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHRocm93IG5ldyBXb3JrYm94RXJyb3IoJ2NoYW5uZWwtbmFtZS1yZXF1aXJlZCcpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMuX2NoYW5uZWxOYW1lID0gY2hhbm5lbE5hbWU7XG4gICAgdGhpcy5faGVhZGVyc1RvQ2hlY2sgPSBoZWFkZXJzVG9DaGVjayB8fCBbXG4gICAgICAnY29udGVudC1sZW5ndGgnLFxuICAgICAgJ2V0YWcnLFxuICAgICAgJ2xhc3QtbW9kaWZpZWQnLFxuICAgIF07XG4gICAgdGhpcy5fc291cmNlID0gc291cmNlIHx8ICd3b3JrYm94LWJyb2FkY2FzdC1jYWNoZS11cGRhdGUnO1xuXG4gICAgLy8gVE9ETyBhc3NlcnQgdHlwZW9mIGhlYWRlcnNUb0NoZWNrIGluc3RhbmNlb2YgQXJyYXlcbiAgfVxuXG4gIC8qKlxuICAgKiBAcmV0dXJuIHtCcm9hZGNhc3RDaGFubmVsfSBUaGUgQnJvYWRjYXN0Q2hhbm5lbCBpbnN0YW5jZSB1c2VkIGZvclxuICAgKiBicm9hZGNhc3RpbmcgdXBkYXRlcy5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICovXG4gIF9nZXRDaGFubmVsKCkge1xuICAgIGlmICghdGhpcy5fY2hhbm5lbCkge1xuICAgICAgdGhpcy5fY2hhbm5lbCA9IG5ldyBCcm9hZGNhc3RDaGFubmVsKHRoaXMuX2NoYW5uZWxOYW1lKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuX2NoYW5uZWw7XG4gIH1cblxuICAvKipcbiAgICogQ29tcGFyZSB0d28gW1Jlc3BvbnNlc10oaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL1Jlc3BvbnNlKVxuICAgKiBhbmQgc2VuZCBhIG1lc3NhZ2UgdmlhIHRoZVxuICAgKiB7QGxpbmsgaHR0cHM6Ly9kZXZlbG9wZXJzLmdvb2dsZS5jb20vd2ViL3VwZGF0ZXMvMjAxNi8wOS9icm9hZGNhc3RjaGFubmVsfEJyb2FkY2FzdCBDaGFubmVsIEFQSX1cbiAgICogaWYgdGhleSBkaWZmZXIuXG4gICAqXG4gICAqIE5laXRoZXIgb2YgdGhlIFJlc3BvbnNlcyBjYW4gYmUge0BsaW5rIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMzkxMDk3ODl8b3BhcXVlfS5cbiAgICpcbiAgICogQHBhcmFtIHtSZXNwb25zZX0gZmlyc3RSZXNwb25zZSBGaXJzdCByZXNwb25zZXMgdG8gY29tcGFyZS5cbiAgICogQHBhcmFtIHtSZXNwb25zZX0gc2Vjb25kUmVzcG9uc2UgU2Vjb25kIHJlc3BvbnNlcyB0byBjb21wYXJlLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gdXJsIFRoZSBVUkwgb2YgdGhlIHVwZGF0ZWQgcmVxdWVzdC5cbiAgICogQHBhcmFtIHtzdHJpbmd9IGNhY2hlTmFtZSBOYW1lIG9mIHRoZSBjYWNoZSB0aGUgcmVzcG9uc2VzIGJlbG9uZyB0by5cbiAgICogVGhpcyBpcyBpbmNsdWRlZCBpbiB0aGUgbWVzc2FnZSBwb3N0ZWQgb24gdGhlIGJyb2FkY2FzdCBjaGFubmVsLlxuICAgKi9cbiAgbm90aWZ5SWZVcGRhdGVkKGZpcnN0UmVzcG9uc2UsIHNlY29uZFJlc3BvbnNlLCB1cmwsIGNhY2hlTmFtZSkge1xuICAgIC8vIFRPRE86IE1vdmUgdG8gYXNzZXJ0XG4gICAgLy8gaXNUeXBlKHtjYWNoZU5hbWV9LCAnc3RyaW5nJyk7XG5cbiAgICBpZiAoIXJlc3BvbnNlc0FyZVNhbWUoXG4gICAgICBmaXJzdFJlc3BvbnNlLCBzZWNvbmRSZXNwb25zZSwgdGhpcy5faGVhZGVyc1RvQ2hlY2spKSB7XG4gICAgICBicm9hZGNhc3RVcGRhdGUodGhpcy5fZ2V0Q2hhbm5lbCgpLCBjYWNoZU5hbWUsIHVybCwgdGhpcy5fc291cmNlKTtcbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IHtCcm9hZGNhc3RDYWNoZVVwZGF0ZX07XG4iLCIvKlxuIENvcHlyaWdodCAyMDE2IEdvb2dsZSBJbmMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG5cbiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG5cbiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiovXG5cbmltcG9ydCB7V29ya2JveEVycm9yfSBmcm9tICd3b3JrYm94LWNvcmUvX3ByaXZhdGUvV29ya2JveEVycm9yLm1qcyc7XG5pbXBvcnQge2xvZ2dlcn0gZnJvbSAnd29ya2JveC1jb3JlL19wcml2YXRlL2xvZ2dlci5tanMnO1xuaW1wb3J0ICcuLi9fdmVyc2lvbi5tanMnO1xuXG4vKipcbiAqIEdpdmVuIHR3byBgUmVzcG9uc2Unc2AsIGNvbXBhcmVzIHNldmVyYWwgaGVhZGVyIHZhbHVlcyB0byBzZWUgaWYgdGhleSBhcmVcbiAqIHRoZSBzYW1lIG9yIG5vdC5cbiAqXG4gKiBAcGFyYW0ge1Jlc3BvbnNlfSBmaXJzdFJlc3BvbnNlXG4gKiBAcGFyYW0ge1Jlc3BvbnNlfSBzZWNvbmRSZXNwb25zZVxuICogQHBhcmFtIHtBcnJheTxzdHJpbmc+fSBoZWFkZXJzVG9DaGVja1xuICogQHJldHVybiB7Ym9vbGVhbn1cbiAqXG4gKiBAbWVtYmVyb2Ygd29ya2JveC5icm9hZGNhc3RVcGRhdGVcbiAqIEBwcml2YXRlXG4gKi9cbmNvbnN0IHJlc3BvbnNlc0FyZVNhbWUgPSAoZmlyc3RSZXNwb25zZSwgc2Vjb25kUmVzcG9uc2UsIGhlYWRlcnNUb0NoZWNrKSA9PiB7XG4gIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7XG4gICAgaWYgKCEoZmlyc3RSZXNwb25zZSBpbnN0YW5jZW9mIFJlc3BvbnNlICYmXG4gICAgICBzZWNvbmRSZXNwb25zZSBpbnN0YW5jZW9mIFJlc3BvbnNlKSkge1xuICAgICAgdGhyb3cgbmV3IFdvcmtib3hFcnJvcignaW52YWxpZC1yZXNwb25zZXMtYXJlLXNhbWUtYXJncycpO1xuICAgIH1cbiAgfVxuXG4gIGNvbnN0IGF0TGVhc3RPbmVIZWFkZXJBdmFpbGFibGUgPSBoZWFkZXJzVG9DaGVjay5zb21lKChoZWFkZXIpID0+IHtcbiAgICByZXR1cm4gZmlyc3RSZXNwb25zZS5oZWFkZXJzLmhhcyhoZWFkZXIpICYmXG4gICAgICBzZWNvbmRSZXNwb25zZS5oZWFkZXJzLmhhcyhoZWFkZXIpO1xuICB9KTtcblxuICBpZiAoIWF0TGVhc3RPbmVIZWFkZXJBdmFpbGFibGUpIHtcbiAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykge1xuICAgICAgbG9nZ2VyLndhcm4oYFVuYWJsZSB0byBkZXRlcm1pbmUgd2hlcmUgdGhlIHJlc3BvbnNlIGhhcyBiZWVuIHVwZGF0ZWQgYCArXG4gICAgICAgIGBiZWNhdXNlIG5vbmUgb2YgdGhlIGhlYWRlcnMgdGhhdCB3b3VsZCBiZSBjaGVja2VkIGFyZSBwcmVzZW50LmApO1xuICAgICAgbG9nZ2VyLmRlYnVnKGBBdHRlbXB0aW5nIHRvIGNvbXBhcmUgdGhlIGZvbGxvd2luZzogYCxcbiAgICAgICAgZmlyc3RSZXNwb25zZSwgc2Vjb25kUmVzcG9uc2UsIGhlYWRlcnNUb0NoZWNrKTtcbiAgICB9XG5cbiAgICAvLyBKdXN0IHJldHVybiB0cnVlLCBpbmRpY2F0aW5nIHRoZSB0aGF0IHJlc3BvbnNlcyBhcmUgdGhlIHNhbWUsIHNpbmNlIHdlXG4gICAgLy8gY2FuJ3QgZGV0ZXJtaW5lIG90aGVyd2lzZS5cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIHJldHVybiBoZWFkZXJzVG9DaGVjay5ldmVyeSgoaGVhZGVyKSA9PiB7XG4gICAgY29uc3QgaGVhZGVyU3RhdGVDb21wYXJpc29uID0gZmlyc3RSZXNwb25zZS5oZWFkZXJzLmhhcyhoZWFkZXIpID09PVxuICAgICAgc2Vjb25kUmVzcG9uc2UuaGVhZGVycy5oYXMoaGVhZGVyKTtcbiAgICBjb25zdCBoZWFkZXJWYWx1ZUNvbXBhcmlzb24gPSBmaXJzdFJlc3BvbnNlLmhlYWRlcnMuZ2V0KGhlYWRlcikgPT09XG4gICAgICBzZWNvbmRSZXNwb25zZS5oZWFkZXJzLmdldChoZWFkZXIpO1xuXG4gICAgcmV0dXJuIGhlYWRlclN0YXRlQ29tcGFyaXNvbiAmJiBoZWFkZXJWYWx1ZUNvbXBhcmlzb247XG4gIH0pO1xufTtcblxuZXhwb3J0IHtyZXNwb25zZXNBcmVTYW1lfTtcbiIsIi8qXG4gQ29weXJpZ2h0IDIwMTYgR29vZ2xlIEluYy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcblxuICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcblxuIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuKi9cblxuaW1wb3J0IHthc3NlcnR9IGZyb20gJ3dvcmtib3gtY29yZS9fcHJpdmF0ZS9hc3NlcnQubWpzJztcbmltcG9ydCB7QnJvYWRjYXN0Q2FjaGVVcGRhdGV9IGZyb20gJy4vQnJvYWRjYXN0Q2FjaGVVcGRhdGUubWpzJztcbmltcG9ydCAnLi9fdmVyc2lvbi5tanMnO1xuXG4vKipcbiAqIFRoaXMgcGx1Z2luIHdpbGwgYXV0b21hdGljYWxseSBicm9hZGNhc3QgYSBtZXNzYWdlIHdoZW5ldmVyIGEgY2FjaGVkIHJlc3BvbnNlXG4gKiBpcyB1cGRhdGVkLlxuICpcbiAqIEBtZW1iZXJvZiB3b3JrYm94LmJyb2FkY2FzdFVwZGF0ZVxuICovXG5jbGFzcyBCcm9hZGNhc3RDYWNoZVVwZGF0ZVBsdWdpbiB7XG4gICAgLyoqXG4gICAqIENvbnN0cnVjdCBhIG5ldyBpbnN0YW5jZSB3aXRoIGEgc3BlY2lmaWMgYGNoYW5uZWxOYW1lYCB0b1xuICAgKiBicm9hZGNhc3QgbWVzc2FnZXMgb25cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGNoYW5uZWxOYW1lIFRoZSBuYW1lIHRoYXQgd2lsbCBiZSB1c2VkIHdoZW4gY3JlYXRpbmdcbiAgICogdGhlIGBCcm9hZGNhc3RDaGFubmVsYC5cbiAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnNcbiAgICogQHBhcmFtIHtBcnJheTxzdHJpbmc+fVxuICAgKiBbb3B0aW9ucy5oZWFkZXJzVG9DaGVjaz1bJ2NvbnRlbnQtbGVuZ3RoJywgJ2V0YWcnLCAnbGFzdC1tb2RpZmllZCddXSBBXG4gICAqIGxpc3Qgb2YgaGVhZGVycyB0aGF0IHdpbGwgYmUgdXNlZCB0byBkZXRlcm1pbmUgd2hldGhlciB0aGUgcmVzcG9uc2VzXG4gICAqIGRpZmZlci5cbiAgICogQHBhcmFtIHtzdHJpbmd9IFtvcHRpb25zLnNvdXJjZT0nd29ya2JveC1icm9hZGNhc3QtY2FjaGUtdXBkYXRlJ10gQW5cbiAgICogYXR0cmlidXRpb24gdmFsdWUgdGhhdCBpbmRpY2F0ZXMgd2hlcmUgdGhlIHVwZGF0ZSBvcmlnaW5hdGVkLlxuICAgKi9cbiAgY29uc3RydWN0b3IoY2hhbm5lbE5hbWUsIG9wdGlvbnMpIHtcbiAgICB0aGlzLl9icm9hZGNhc3RVcGRhdGUgPSBuZXcgQnJvYWRjYXN0Q2FjaGVVcGRhdGUoY2hhbm5lbE5hbWUsIG9wdGlvbnMpO1xuICB9XG4gIC8qKlxuICAgKiBBIFwibGlmZWN5Y2xlXCIgY2FsbGJhY2sgdGhhdCB3aWxsIGJlIHRyaWdnZXJlZCBhdXRvbWF0aWNhbGx5IGJ5IHRoZVxuICAgKiBgd29ya2JveC1zd2AgYW5kIGB3b3JrYm94LXJ1bnRpbWUtY2FjaGluZ2AgaGFuZGxlcnMgd2hlbiBhbiBlbnRyeSBpc1xuICAgKiBhZGRlZCB0byBhIGNhY2hlLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAcGFyYW0ge09iamVjdH0gaW5wdXQgVGhlIGlucHV0IG9iamVjdCB0byB0aGlzIGZ1bmN0aW9uLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gaW5wdXQuY2FjaGVOYW1lIE5hbWUgb2YgdGhlIGNhY2hlIHRoZSByZXNwb25zZXMgYmVsb25nIHRvLlxuICAgKiBAcGFyYW0ge1Jlc3BvbnNlfSBbaW5wdXQub2xkUmVzcG9uc2VdIFRoZSBwcmV2aW91cyBjYWNoZWQgdmFsdWUsIGlmIGFueS5cbiAgICogQHBhcmFtIHtSZXNwb25zZX0gaW5wdXQubmV3UmVzcG9uc2UgVGhlIG5ldyB2YWx1ZSBpbiB0aGUgY2FjaGUuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBpbnB1dC51cmwgVGhlIGNhY2hlIGtleSBVUkwuXG4gICAqL1xuICBjYWNoZURpZFVwZGF0ZSh7Y2FjaGVOYW1lLCBvbGRSZXNwb25zZSwgbmV3UmVzcG9uc2UsIHVybH0pIHtcbiAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykge1xuICAgICAgYXNzZXJ0LmlzVHlwZShjYWNoZU5hbWUsICdzdHJpbmcnLCB7XG4gICAgICAgIG1vZHVsZU5hbWU6ICd3b3JrYm94LWJyb2FkY2FzdC1jYWNoZS11cGRhdGUnLFxuICAgICAgICBjbGFzc05hbWU6ICdCcm9hZGNhc3RDYWNoZVVwZGF0ZVBsdWdpbicsXG4gICAgICAgIGZ1bmNOYW1lOiAnY29uc3RydWN0b3InLFxuICAgICAgICBwYXJhbU5hbWU6ICdjYWNoZU5hbWUnLFxuICAgICAgfSk7XG4gICAgICBhc3NlcnQuaXNJbnN0YW5jZShuZXdSZXNwb25zZSwgUmVzcG9uc2UsIHtcbiAgICAgICAgbW9kdWxlTmFtZTogJ3dvcmtib3gtYnJvYWRjYXN0LWNhY2hlLXVwZGF0ZScsXG4gICAgICAgIGNsYXNzTmFtZTogJ0Jyb2FkY2FzdENhY2hlVXBkYXRlUGx1Z2luJyxcbiAgICAgICAgZnVuY05hbWU6ICdjb25zdHJ1Y3RvcicsXG4gICAgICAgIHBhcmFtTmFtZTogJ25ld1Jlc3BvbnNlJyxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGlmICghb2xkUmVzcG9uc2UpIHtcbiAgICAgIC8vIFdpdGhvdXQgYSB0d28gcmVzcG9uc2VzIHRoZXJlIGlzIG5vdGhpbmcgdG8gY29tYXByZVxuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuX2Jyb2FkY2FzdFVwZGF0ZVxuICAgICAgLm5vdGlmeUlmVXBkYXRlZChvbGRSZXNwb25zZSwgbmV3UmVzcG9uc2UsIGNhY2hlTmFtZSwgdXJsKTtcbiAgfVxufVxuXG5leHBvcnQge0Jyb2FkY2FzdENhY2hlVXBkYXRlUGx1Z2lufTtcbiJdLCJuYW1lcyI6WyJ3b3JrYm94IiwidiIsImUiLCJicm9hZGNhc3RVcGRhdGUiLCJjaGFubmVsIiwiY2FjaGVOYW1lIiwidXJsIiwic291cmNlIiwicG9zdE1lc3NhZ2UiLCJtZXNzYWdlVHlwZXMiLCJDQUNIRV9VUERBVEVEIiwiQnJvYWRjYXN0Q2FjaGVVcGRhdGUiLCJjaGFubmVsTmFtZSIsImhlYWRlcnNUb0NoZWNrIiwiX2NoYW5uZWxOYW1lIiwiX2hlYWRlcnNUb0NoZWNrIiwiX3NvdXJjZSIsInRoaXMiLCJfY2hhbm5lbCIsIkJyb2FkY2FzdENoYW5uZWwiLCJmaXJzdFJlc3BvbnNlIiwic2Vjb25kUmVzcG9uc2UiLCJzb21lIiwiaGVhZGVyIiwiaGVhZGVycyIsImhhcyIsImV2ZXJ5IiwiaGVhZGVyU3RhdGVDb21wYXJpc29uIiwiaGVhZGVyVmFsdWVDb21wYXJpc29uIiwiZ2V0IiwicmVzcG9uc2VzQXJlU2FtZSIsIl9nZXRDaGFubmVsIiwiQnJvYWRjYXN0Q2FjaGVVcGRhdGVQbHVnaW4iLCJvcHRpb25zIiwiX2Jyb2FkY2FzdFVwZGF0ZSIsIm9sZFJlc3BvbnNlIiwibmV3UmVzcG9uc2UiLCJub3RpZnlJZlVwZGF0ZWQiXSwibWFwcGluZ3MiOiJvRkFBQSxTQUFTQSxRQUFRQyxFQUFFLGdEQUFnRCxFQUFHLE1BQU1DLElDZTVFLHFCQUdpQixpQkNzQ2pCLE1BQU1DLEVBQWtCLENBQUNDLEVBQVNDLEVBQVdDLEVBQUtDLE9BNEJ4Q0Msa0JBQ0FDLEVBQWFDLG1CQUNiSCxxQkFFT0YsYUFDQ0MsWUM1RFpLLGNBZVFDLEdBQWFDLGVBQUNBLEVBQUROLE9BQWlCQSxZQU9uQ08sRUFBZUYsT0FDZkcsRUFBa0JGLElBQ3JCLGlCQUNBLE9BQ0Esc0JBRUdHLEVBQVVULEdBQVUsNENBWXBCVSxLQUFLQyxTQUNIQSxFQUFXLElBQUlDLGlCQUFpQkYsS0FBS0gsSUFFckNHLEtBQUtDLGtCQWlCRUUsRUFBZUMsRUFBZ0JmLEVBQUtELEdDMUQ3QixFQUFDZSxFQUFlQyxFQUFnQlIsS0FRckJBLEVBQWVTLEtBQU1DLEdBQzlDSCxFQUFjSSxRQUFRQyxJQUFJRixJQUMvQkYsRUFBZUcsUUFBUUMsSUFBSUYsS0FnQnhCVixFQUFlYSxNQUFPSCxVQUNyQkksRUFBd0JQLEVBQWNJLFFBQVFDLElBQUlGLEtBQ3RERixFQUFlRyxRQUFRQyxJQUFJRixHQUN2QkssRUFBd0JSLEVBQWNJLFFBQVFLLElBQUlOLEtBQ3RERixFQUFlRyxRQUFRSyxJQUFJTixVQUV0QkksR0FBeUJDLElEOEIzQkUsQ0FDSFYsRUFBZUMsRUFBZ0JKLEtBQUtGLE1BQ3BCRSxLQUFLYyxJQUFlMUIsRUFBV0MsRUFBS1csS0FBS0QsVUV0RXpEZ0IsY0FlUXBCLEVBQWFxQixRQUNsQkMsRUFBbUIsSUFBSXZCLEVBQXFCQyxFQUFhcUIsbUJBY2pENUIsVUFBQ0EsRUFBRDhCLFlBQVlBLEVBQVpDLFlBQXlCQSxFQUF6QjlCLElBQXNDQSxJQWdCOUM2QixRQUtBRCxFQUNGRyxnQkFBZ0JGLEVBQWFDLEVBQWEvQixFQUFXQyJ9"}