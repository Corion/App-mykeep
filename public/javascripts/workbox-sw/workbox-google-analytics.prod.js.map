{"version":3,"file":"workbox-google-analytics.prod.js","sources":["packages/workbox-google-analytics/_version.mjs","packages/workbox-google-analytics/_default.mjs","packages/workbox-google-analytics/utils/constants.mjs"],"sourcesContent":["try{self.workbox.v['workbox:google-analytics:3.0.0-alpha.1']=1;}catch(e){} // eslint-disable-line","/*\n Copyright 2017 Google Inc. All Rights Reserved.\n Licensed under the Apache License, Version 2.0 (the \"License\");\n you may not use this file except in compliance with the License.\n You may obtain a copy of the License at\n\n     http://www.apache.org/licenses/LICENSE-2.0\n\n Unless required by applicable law or agreed to in writing, software\n distributed under the License is distributed on an \"AS IS\" BASIS,\n WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n See the License for the specific language governing permissions and\n limitations under the License.\n*/\n\nimport {Queue} from 'workbox-background-sync/Queue.mjs';\nimport {QueuePlugin} from 'workbox-background-sync/QueuePlugin.mjs';\nimport {cacheNames} from 'workbox-core/_private/cacheNames.mjs';\nimport {Route} from 'workbox-routing/Route.mjs';\nimport {Router} from 'workbox-routing/Router.mjs';\nimport {NetworkFirst} from 'workbox-strategies/NetworkFirst.mjs';\nimport {NetworkOnly} from 'workbox-strategies/NetworkOnly.mjs';\nimport {\n  QUEUE_NAME,\n  MAX_RETENTION_TIME,\n  GOOGLE_ANALYTICS_HOST,\n  GTM_HOST,\n  ANALYTICS_JS_PATH,\n  GTAG_JS_PATH,\n  COLLECT_PATH,\n} from './utils/constants.mjs';\nimport './_version.mjs';\n\n/**\n * Promisifies the FileReader API to await a text response from a Blob.\n *\n * @param {Blob} blob\n * @return {Promise<string>}\n *\n * @private\n */\nconst getTextFromBlob = (blob) => {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.onloadend = () => resolve(reader.result);\n    reader.onerror = () => reject(reader.error);\n    reader.readAsText(blob);\n  });\n};\n\n/**\n * Creates the requestWillDequeue callback to be used with the background\n * sync queue plugin. The callback takes the failed request and adds the\n * `qt` param based on the current time, as well as applies any other\n * user-defined hit modifications.\n *\n * @param {Object} config See workbox.googleAnalytics.initialize.\n * @return {Function} The requestWillDequeu callback function.\n *\n * @private\n */\nconst createRequestWillReplayCallback = (config) => {\n  return async ({url, timestamp, requestInit}) => {\n    // Measurement protocol requests can set their payload parameters in either\n    // the URL query string (for GET requests) or the POST body.\n    let params;\n    if (requestInit.body) {\n      const payload = await getTextFromBlob(requestInit.body);\n      params = new URLSearchParams(payload);\n    } else {\n      params = new URL(url).searchParams;\n    }\n\n    // Set the qt param prior to apply the hitFilter or parameterOverrides.\n    const queueTime = Date.now() - timestamp;\n    params.set('qt', queueTime);\n\n    if (config.parameterOverrides) {\n      for (const param of Object.keys(config.parameterOverrides)) {\n        const value = config.parameterOverrides[param];\n        params.set(param, value);\n      }\n    }\n\n    if (typeof config.hitFilter === 'function') {\n      config.hitFilter.call(null, params);\n    }\n\n    requestInit.body = params.toString();\n    requestInit.method = 'POST';\n    requestInit.mode = 'cors';\n    requestInit.credentials = 'omit';\n    requestInit.headers = '[[\"Content-Type\", \"text/plain\"]]';\n    requestInit.url = `https://${GOOGLE_ANALYTICS_HOST}/${COLLECT_PATH}`;\n  };\n};\n\n/**\n * Creates GET and POST routes to catch failed Measurement Protocol hits.\n *\n * @param {Queue} queue\n * @return {Array<Route>} The created routes.\n *\n * @private\n */\nconst createCollectRoutes = (queue) => {\n  const match = ({url}) => url.hostname === GOOGLE_ANALYTICS_HOST &&\n      url.pathname === COLLECT_PATH;\n\n  const handler = new NetworkOnly({\n    plugins: [new QueuePlugin(queue)],\n  });\n\n  return [\n    new Route(match, handler, 'GET'),\n    new Route(match, handler, 'POST'),\n  ];\n};\n\n/**\n * Creates a route with a network first strategy for the analytics.js script.\n *\n * @param {string} cacheName\n * @return {Route} The created route.\n *\n * @private\n */\nconst createAnalyticsJsRoute = (cacheName) => {\n  const match = ({url}) => url.hostname === GOOGLE_ANALYTICS_HOST &&\n      url.pathname === ANALYTICS_JS_PATH;\n  const handler = new NetworkFirst({cacheName});\n\n  return new Route(match, handler, 'GET');\n};\n\n/**\n * Creates a route with a network first strategy for the gtag.js script.\n *\n * @param {string} cacheName\n * @return {Route} The created route.\n *\n * @private\n */\nconst createGtagJsRoute = (cacheName) => {\n  const match = ({url}) => url.hostname === GTM_HOST &&\n      url.pathname === GTAG_JS_PATH;\n  const handler = new NetworkFirst({cacheName});\n\n  return new Route(match, handler, 'GET');\n};\n\n/**\n * @param {Object=} [options]\n * @param {Object} [options.cacheName] The cache name to store and retrieve\n *     analytics.js. Defaults to the cache names provided by `workbox-core`.\n * @param {Object} [options.parameterOverrides]\n *     [Measurement Protocol parameters](https://developers.google.com/analytics/devguides/collection/protocol/v1/parameters),\n *     expressed as key/value pairs, to be added to replayed Google Analytics\n *     requests. This can be used to, e.g., set a custom dimension indicating\n *     that the request was replayed.\n * @param {Function} [options.hitFilter] A function that allows you to modify\n *     the hit parameters prior to replaying\n *     the hit. The function is invoked with the original hit's URLSearchParams\n *     object as its only argument.\n *\n * @memberof workbox.googleAnalytics\n */\nconst initialize = (options = {}) => {\n  const cacheName = cacheNames.getGoogleAnalyticsName(options.cacheName);\n\n  const queue = new Queue(QUEUE_NAME, {\n    maxRetentionTime: MAX_RETENTION_TIME,\n    callbacks: {\n      requestWillReplay: createRequestWillReplayCallback(options),\n    },\n  });\n\n  const routes = [\n    createAnalyticsJsRoute(cacheName),\n    createGtagJsRoute(cacheName),\n    ...createCollectRoutes(queue),\n  ];\n\n  const router = new Router();\n  for (const route of routes) {\n    router.registerRoute(route);\n  }\n\n  self.addEventListener('fetch', (evt) => {\n    const responsePromise = router.handleRequest(evt);\n    if (responsePromise) {\n      evt.respondWith(responsePromise);\n    }\n  });\n};\n\nexport {\n  initialize,\n};\n","/*\n Copyright 2017 Google Inc. All Rights Reserved.\n Licensed under the Apache License, Version 2.0 (the \"License\");\n you may not use this file except in compliance with the License.\n You may obtain a copy of the License at\n\n     http://www.apache.org/licenses/LICENSE-2.0\n\n Unless required by applicable law or agreed to in writing, software\n distributed under the License is distributed on an \"AS IS\" BASIS,\n WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n See the License for the specific language governing permissions and\n limitations under the License.\n*/\n\nimport '../_version.mjs';\n\nexport const QUEUE_NAME = 'workbox-google-analytics';\nexport const MAX_RETENTION_TIME = 1000 * 60 * 60 * 48; // Two days\nexport const GOOGLE_ANALYTICS_HOST = 'www.google-analytics.com';\nexport const GTM_HOST = 'www.googletagmanager.com';\nexport const ANALYTICS_JS_PATH = '/analytics.js';\nexport const GTAG_JS_PATH = '/gtag/js';\nexport const COLLECT_PATH = '/collect';\n"],"names":["workbox","v","e","options","cacheName","cacheNames","getGoogleAnalyticsName","queue","Queue","config","url","timestamp","requestInit","params","body","payload","blob","Promise","resolve","reject","reader","FileReader","onloadend","result","onerror","error","readAsText","getTextFromBlob","URLSearchParams","URL","searchParams","queueTime","Date","now","set","parameterOverrides","param","Object","keys","value","hitFilter","call","toString","method","mode","credentials","headers","createRequestWillReplayCallback","routes","handler","NetworkFirst","Route","hostname","pathname","createAnalyticsJsRoute","createGtagJsRoute","match","NetworkOnly","QueuePlugin","createCollectRoutes","router","Router","route","registerRoute","addEventListener","evt","responsePromise","handleRequest","respondWith"],"mappings":"kGAAA,SAASA,QAAQC,EAAE,0CAA0C,EAAG,MAAMC,wBCuKnD,EAACC,cACZC,EAAYC,aAAWC,uBAAuBH,EAAQC,WAEtDG,EAAQ,IAAIC,QCzJM,6CACQ,oCD2COC,CAAAA,6CAChC,WAAOC,IAACA,EAADC,UAAMA,EAANC,YAAiBA,QAGzBC,KACAD,EAAYE,KAAM,OACdC,OA1BaC,CAAAA,GAChB,IAAIC,QAAQ,CAACC,EAASC,WACrBC,EAAS,IAAIC,aACZC,UAAY,KAAMJ,EAAQE,EAAOG,WACjCC,QAAU,KAAML,EAAOC,EAAOK,UAC9BC,WAAWV,KAqBMW,CAAgBf,EAAYE,QACzC,IAAIc,gBAAgBb,UAEpB,IAAIc,IAAInB,GAAKoB,mBAIlBC,EAAYC,KAAKC,MAAQtB,OACxBuB,IAAI,KAAMH,GAEbtB,EAAO0B,uBACJ,MAAMC,KAASC,OAAOC,KAAK7B,EAAO0B,oBAAqB,OACpDI,EAAQ9B,EAAO0B,mBAAmBC,KACjCF,IAAIE,EAAOG,GAIU,mBAArB9B,EAAO+B,aACTA,UAAUC,KAAK,KAAM5B,KAGlBC,KAAOD,EAAO6B,aACdC,OAAS,SACTC,KAAO,SACPC,YAAc,SACdC,QAAU,qCACVpC,IAAO,qGAgFEqC,CAAgC5C,MAIjD6C,GAlDwB5C,CAAAA,UAGxB6C,EAAU,IAAIC,gBAAc9C,UAAAA,WAE3B,IAAI+C,QAJG,EAAEzC,IAAAA,KC7GmB,6BD6GVA,EAAI0C,UC3GE,kBD4G3B1C,EAAI2C,SAGgBJ,EAAS,QA8C/BK,CAAuBlD,GAnCAA,CAAAA,UAGnB6C,EAAU,IAAIC,gBAAc9C,UAAAA,WAE3B,IAAI+C,QAJG,EAAEzC,IAAAA,KC5HM,6BD4HGA,EAAI0C,UC1HH,aD2HtB1C,EAAI2C,SAGgBJ,EAAS,QA+B/BM,CAAkBnD,MA1EOG,CAAAA,UACrBiD,EAAQ,EAAE9C,IAAAA,KCvFmB,6BDuFVA,EAAI0C,UCnFH,aDoFtB1C,EAAI2C,SAEFJ,EAAU,IAAIQ,wBACR,IAAIC,cAAYnD,aAI1B,IAAI4C,QAAMK,EAAOP,EAAS,OAC1B,IAAIE,QAAMK,EAAOP,EAAS,UAiEvBU,CAAoBpD,IAGnBqD,EAAS,IAAIC,aACd,MAAMC,KAASd,IACXe,cAAcD,QAGlBE,iBAAiB,QAAUC,UACxBC,EAAkBN,EAAOO,cAAcF,GACzCC,KACEE,YAAYF","preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjpudWxsLCJzb3VyY2VzIjpbIi9Vc2Vycy9tYXR0Z2F1bnQvUHJvamVjdHMvQ29kZS93b3JrYm94L2dlbmVyYXRlZC1yZWxlYXNlLWZpbGVzL3YzLjAuMC1hbHBoYS4xL3NvdXJjZS1jb2RlL3BhY2thZ2VzL3dvcmtib3gtZ29vZ2xlLWFuYWx5dGljcy9fdmVyc2lvbi5tanMiLCIvVXNlcnMvbWF0dGdhdW50L1Byb2plY3RzL0NvZGUvd29ya2JveC9nZW5lcmF0ZWQtcmVsZWFzZS1maWxlcy92My4wLjAtYWxwaGEuMS9zb3VyY2UtY29kZS9wYWNrYWdlcy93b3JrYm94LWdvb2dsZS1hbmFseXRpY3MvX2RlZmF1bHQubWpzIiwiL1VzZXJzL21hdHRnYXVudC9Qcm9qZWN0cy9Db2RlL3dvcmtib3gvZ2VuZXJhdGVkLXJlbGVhc2UtZmlsZXMvdjMuMC4wLWFscGhhLjEvc291cmNlLWNvZGUvcGFja2FnZXMvd29ya2JveC1nb29nbGUtYW5hbHl0aWNzL3V0aWxzL2NvbnN0YW50cy5tanMiXSwic291cmNlc0NvbnRlbnQiOlsidHJ5e3NlbGYud29ya2JveC52Wyd3b3JrYm94Omdvb2dsZS1hbmFseXRpY3M6My4wLjAtYWxwaGEuMSddPTE7fWNhdGNoKGUpe30gLy8gZXNsaW50LWRpc2FibGUtbGluZSIsIi8qXG4gQ29weXJpZ2h0IDIwMTcgR29vZ2xlIEluYy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcblxuICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcblxuIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuKi9cblxuaW1wb3J0IHtRdWV1ZX0gZnJvbSAnd29ya2JveC1iYWNrZ3JvdW5kLXN5bmMvUXVldWUubWpzJztcbmltcG9ydCB7UXVldWVQbHVnaW59IGZyb20gJ3dvcmtib3gtYmFja2dyb3VuZC1zeW5jL1F1ZXVlUGx1Z2luLm1qcyc7XG5pbXBvcnQge2NhY2hlTmFtZXN9IGZyb20gJ3dvcmtib3gtY29yZS9fcHJpdmF0ZS9jYWNoZU5hbWVzLm1qcyc7XG5pbXBvcnQge1JvdXRlfSBmcm9tICd3b3JrYm94LXJvdXRpbmcvUm91dGUubWpzJztcbmltcG9ydCB7Um91dGVyfSBmcm9tICd3b3JrYm94LXJvdXRpbmcvUm91dGVyLm1qcyc7XG5pbXBvcnQge05ldHdvcmtGaXJzdH0gZnJvbSAnd29ya2JveC1zdHJhdGVnaWVzL05ldHdvcmtGaXJzdC5tanMnO1xuaW1wb3J0IHtOZXR3b3JrT25seX0gZnJvbSAnd29ya2JveC1zdHJhdGVnaWVzL05ldHdvcmtPbmx5Lm1qcyc7XG5pbXBvcnQge1xuICBRVUVVRV9OQU1FLFxuICBNQVhfUkVURU5USU9OX1RJTUUsXG4gIEdPT0dMRV9BTkFMWVRJQ1NfSE9TVCxcbiAgR1RNX0hPU1QsXG4gIEFOQUxZVElDU19KU19QQVRILFxuICBHVEFHX0pTX1BBVEgsXG4gIENPTExFQ1RfUEFUSCxcbn0gZnJvbSAnLi91dGlscy9jb25zdGFudHMubWpzJztcbmltcG9ydCAnLi9fdmVyc2lvbi5tanMnO1xuXG4vKipcbiAqIFByb21pc2lmaWVzIHRoZSBGaWxlUmVhZGVyIEFQSSB0byBhd2FpdCBhIHRleHQgcmVzcG9uc2UgZnJvbSBhIEJsb2IuXG4gKlxuICogQHBhcmFtIHtCbG9ifSBibG9iXG4gKiBAcmV0dXJuIHtQcm9taXNlPHN0cmluZz59XG4gKlxuICogQHByaXZhdGVcbiAqL1xuY29uc3QgZ2V0VGV4dEZyb21CbG9iID0gKGJsb2IpID0+IHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICBjb25zdCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xuICAgIHJlYWRlci5vbmxvYWRlbmQgPSAoKSA9PiByZXNvbHZlKHJlYWRlci5yZXN1bHQpO1xuICAgIHJlYWRlci5vbmVycm9yID0gKCkgPT4gcmVqZWN0KHJlYWRlci5lcnJvcik7XG4gICAgcmVhZGVyLnJlYWRBc1RleHQoYmxvYik7XG4gIH0pO1xufTtcblxuLyoqXG4gKiBDcmVhdGVzIHRoZSByZXF1ZXN0V2lsbERlcXVldWUgY2FsbGJhY2sgdG8gYmUgdXNlZCB3aXRoIHRoZSBiYWNrZ3JvdW5kXG4gKiBzeW5jIHF1ZXVlIHBsdWdpbi4gVGhlIGNhbGxiYWNrIHRha2VzIHRoZSBmYWlsZWQgcmVxdWVzdCBhbmQgYWRkcyB0aGVcbiAqIGBxdGAgcGFyYW0gYmFzZWQgb24gdGhlIGN1cnJlbnQgdGltZSwgYXMgd2VsbCBhcyBhcHBsaWVzIGFueSBvdGhlclxuICogdXNlci1kZWZpbmVkIGhpdCBtb2RpZmljYXRpb25zLlxuICpcbiAqIEBwYXJhbSB7T2JqZWN0fSBjb25maWcgU2VlIHdvcmtib3guZ29vZ2xlQW5hbHl0aWNzLmluaXRpYWxpemUuXG4gKiBAcmV0dXJuIHtGdW5jdGlvbn0gVGhlIHJlcXVlc3RXaWxsRGVxdWV1IGNhbGxiYWNrIGZ1bmN0aW9uLlxuICpcbiAqIEBwcml2YXRlXG4gKi9cbmNvbnN0IGNyZWF0ZVJlcXVlc3RXaWxsUmVwbGF5Q2FsbGJhY2sgPSAoY29uZmlnKSA9PiB7XG4gIHJldHVybiBhc3luYyAoe3VybCwgdGltZXN0YW1wLCByZXF1ZXN0SW5pdH0pID0+IHtcbiAgICAvLyBNZWFzdXJlbWVudCBwcm90b2NvbCByZXF1ZXN0cyBjYW4gc2V0IHRoZWlyIHBheWxvYWQgcGFyYW1ldGVycyBpbiBlaXRoZXJcbiAgICAvLyB0aGUgVVJMIHF1ZXJ5IHN0cmluZyAoZm9yIEdFVCByZXF1ZXN0cykgb3IgdGhlIFBPU1QgYm9keS5cbiAgICBsZXQgcGFyYW1zO1xuICAgIGlmIChyZXF1ZXN0SW5pdC5ib2R5KSB7XG4gICAgICBjb25zdCBwYXlsb2FkID0gYXdhaXQgZ2V0VGV4dEZyb21CbG9iKHJlcXVlc3RJbml0LmJvZHkpO1xuICAgICAgcGFyYW1zID0gbmV3IFVSTFNlYXJjaFBhcmFtcyhwYXlsb2FkKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcGFyYW1zID0gbmV3IFVSTCh1cmwpLnNlYXJjaFBhcmFtcztcbiAgICB9XG5cbiAgICAvLyBTZXQgdGhlIHF0IHBhcmFtIHByaW9yIHRvIGFwcGx5IHRoZSBoaXRGaWx0ZXIgb3IgcGFyYW1ldGVyT3ZlcnJpZGVzLlxuICAgIGNvbnN0IHF1ZXVlVGltZSA9IERhdGUubm93KCkgLSB0aW1lc3RhbXA7XG4gICAgcGFyYW1zLnNldCgncXQnLCBxdWV1ZVRpbWUpO1xuXG4gICAgaWYgKGNvbmZpZy5wYXJhbWV0ZXJPdmVycmlkZXMpIHtcbiAgICAgIGZvciAoY29uc3QgcGFyYW0gb2YgT2JqZWN0LmtleXMoY29uZmlnLnBhcmFtZXRlck92ZXJyaWRlcykpIHtcbiAgICAgICAgY29uc3QgdmFsdWUgPSBjb25maWcucGFyYW1ldGVyT3ZlcnJpZGVzW3BhcmFtXTtcbiAgICAgICAgcGFyYW1zLnNldChwYXJhbSwgdmFsdWUpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmICh0eXBlb2YgY29uZmlnLmhpdEZpbHRlciA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgY29uZmlnLmhpdEZpbHRlci5jYWxsKG51bGwsIHBhcmFtcyk7XG4gICAgfVxuXG4gICAgcmVxdWVzdEluaXQuYm9keSA9IHBhcmFtcy50b1N0cmluZygpO1xuICAgIHJlcXVlc3RJbml0Lm1ldGhvZCA9ICdQT1NUJztcbiAgICByZXF1ZXN0SW5pdC5tb2RlID0gJ2NvcnMnO1xuICAgIHJlcXVlc3RJbml0LmNyZWRlbnRpYWxzID0gJ29taXQnO1xuICAgIHJlcXVlc3RJbml0LmhlYWRlcnMgPSAnW1tcIkNvbnRlbnQtVHlwZVwiLCBcInRleHQvcGxhaW5cIl1dJztcbiAgICByZXF1ZXN0SW5pdC51cmwgPSBgaHR0cHM6Ly8ke0dPT0dMRV9BTkFMWVRJQ1NfSE9TVH0vJHtDT0xMRUNUX1BBVEh9YDtcbiAgfTtcbn07XG5cbi8qKlxuICogQ3JlYXRlcyBHRVQgYW5kIFBPU1Qgcm91dGVzIHRvIGNhdGNoIGZhaWxlZCBNZWFzdXJlbWVudCBQcm90b2NvbCBoaXRzLlxuICpcbiAqIEBwYXJhbSB7UXVldWV9IHF1ZXVlXG4gKiBAcmV0dXJuIHtBcnJheTxSb3V0ZT59IFRoZSBjcmVhdGVkIHJvdXRlcy5cbiAqXG4gKiBAcHJpdmF0ZVxuICovXG5jb25zdCBjcmVhdGVDb2xsZWN0Um91dGVzID0gKHF1ZXVlKSA9PiB7XG4gIGNvbnN0IG1hdGNoID0gKHt1cmx9KSA9PiB1cmwuaG9zdG5hbWUgPT09IEdPT0dMRV9BTkFMWVRJQ1NfSE9TVCAmJlxuICAgICAgdXJsLnBhdGhuYW1lID09PSBDT0xMRUNUX1BBVEg7XG5cbiAgY29uc3QgaGFuZGxlciA9IG5ldyBOZXR3b3JrT25seSh7XG4gICAgcGx1Z2luczogW25ldyBRdWV1ZVBsdWdpbihxdWV1ZSldLFxuICB9KTtcblxuICByZXR1cm4gW1xuICAgIG5ldyBSb3V0ZShtYXRjaCwgaGFuZGxlciwgJ0dFVCcpLFxuICAgIG5ldyBSb3V0ZShtYXRjaCwgaGFuZGxlciwgJ1BPU1QnKSxcbiAgXTtcbn07XG5cbi8qKlxuICogQ3JlYXRlcyBhIHJvdXRlIHdpdGggYSBuZXR3b3JrIGZpcnN0IHN0cmF0ZWd5IGZvciB0aGUgYW5hbHl0aWNzLmpzIHNjcmlwdC5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gY2FjaGVOYW1lXG4gKiBAcmV0dXJuIHtSb3V0ZX0gVGhlIGNyZWF0ZWQgcm91dGUuXG4gKlxuICogQHByaXZhdGVcbiAqL1xuY29uc3QgY3JlYXRlQW5hbHl0aWNzSnNSb3V0ZSA9IChjYWNoZU5hbWUpID0+IHtcbiAgY29uc3QgbWF0Y2ggPSAoe3VybH0pID0+IHVybC5ob3N0bmFtZSA9PT0gR09PR0xFX0FOQUxZVElDU19IT1NUICYmXG4gICAgICB1cmwucGF0aG5hbWUgPT09IEFOQUxZVElDU19KU19QQVRIO1xuICBjb25zdCBoYW5kbGVyID0gbmV3IE5ldHdvcmtGaXJzdCh7Y2FjaGVOYW1lfSk7XG5cbiAgcmV0dXJuIG5ldyBSb3V0ZShtYXRjaCwgaGFuZGxlciwgJ0dFVCcpO1xufTtcblxuLyoqXG4gKiBDcmVhdGVzIGEgcm91dGUgd2l0aCBhIG5ldHdvcmsgZmlyc3Qgc3RyYXRlZ3kgZm9yIHRoZSBndGFnLmpzIHNjcmlwdC5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gY2FjaGVOYW1lXG4gKiBAcmV0dXJuIHtSb3V0ZX0gVGhlIGNyZWF0ZWQgcm91dGUuXG4gKlxuICogQHByaXZhdGVcbiAqL1xuY29uc3QgY3JlYXRlR3RhZ0pzUm91dGUgPSAoY2FjaGVOYW1lKSA9PiB7XG4gIGNvbnN0IG1hdGNoID0gKHt1cmx9KSA9PiB1cmwuaG9zdG5hbWUgPT09IEdUTV9IT1NUICYmXG4gICAgICB1cmwucGF0aG5hbWUgPT09IEdUQUdfSlNfUEFUSDtcbiAgY29uc3QgaGFuZGxlciA9IG5ldyBOZXR3b3JrRmlyc3Qoe2NhY2hlTmFtZX0pO1xuXG4gIHJldHVybiBuZXcgUm91dGUobWF0Y2gsIGhhbmRsZXIsICdHRVQnKTtcbn07XG5cbi8qKlxuICogQHBhcmFtIHtPYmplY3Q9fSBbb3B0aW9uc11cbiAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9ucy5jYWNoZU5hbWVdIFRoZSBjYWNoZSBuYW1lIHRvIHN0b3JlIGFuZCByZXRyaWV2ZVxuICogICAgIGFuYWx5dGljcy5qcy4gRGVmYXVsdHMgdG8gdGhlIGNhY2hlIG5hbWVzIHByb3ZpZGVkIGJ5IGB3b3JrYm94LWNvcmVgLlxuICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zLnBhcmFtZXRlck92ZXJyaWRlc11cbiAqICAgICBbTWVhc3VyZW1lbnQgUHJvdG9jb2wgcGFyYW1ldGVyc10oaHR0cHM6Ly9kZXZlbG9wZXJzLmdvb2dsZS5jb20vYW5hbHl0aWNzL2Rldmd1aWRlcy9jb2xsZWN0aW9uL3Byb3RvY29sL3YxL3BhcmFtZXRlcnMpLFxuICogICAgIGV4cHJlc3NlZCBhcyBrZXkvdmFsdWUgcGFpcnMsIHRvIGJlIGFkZGVkIHRvIHJlcGxheWVkIEdvb2dsZSBBbmFseXRpY3NcbiAqICAgICByZXF1ZXN0cy4gVGhpcyBjYW4gYmUgdXNlZCB0bywgZS5nLiwgc2V0IGEgY3VzdG9tIGRpbWVuc2lvbiBpbmRpY2F0aW5nXG4gKiAgICAgdGhhdCB0aGUgcmVxdWVzdCB3YXMgcmVwbGF5ZWQuXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBbb3B0aW9ucy5oaXRGaWx0ZXJdIEEgZnVuY3Rpb24gdGhhdCBhbGxvd3MgeW91IHRvIG1vZGlmeVxuICogICAgIHRoZSBoaXQgcGFyYW1ldGVycyBwcmlvciB0byByZXBsYXlpbmdcbiAqICAgICB0aGUgaGl0LiBUaGUgZnVuY3Rpb24gaXMgaW52b2tlZCB3aXRoIHRoZSBvcmlnaW5hbCBoaXQncyBVUkxTZWFyY2hQYXJhbXNcbiAqICAgICBvYmplY3QgYXMgaXRzIG9ubHkgYXJndW1lbnQuXG4gKlxuICogQG1lbWJlcm9mIHdvcmtib3guZ29vZ2xlQW5hbHl0aWNzXG4gKi9cbmNvbnN0IGluaXRpYWxpemUgPSAob3B0aW9ucyA9IHt9KSA9PiB7XG4gIGNvbnN0IGNhY2hlTmFtZSA9IGNhY2hlTmFtZXMuZ2V0R29vZ2xlQW5hbHl0aWNzTmFtZShvcHRpb25zLmNhY2hlTmFtZSk7XG5cbiAgY29uc3QgcXVldWUgPSBuZXcgUXVldWUoUVVFVUVfTkFNRSwge1xuICAgIG1heFJldGVudGlvblRpbWU6IE1BWF9SRVRFTlRJT05fVElNRSxcbiAgICBjYWxsYmFja3M6IHtcbiAgICAgIHJlcXVlc3RXaWxsUmVwbGF5OiBjcmVhdGVSZXF1ZXN0V2lsbFJlcGxheUNhbGxiYWNrKG9wdGlvbnMpLFxuICAgIH0sXG4gIH0pO1xuXG4gIGNvbnN0IHJvdXRlcyA9IFtcbiAgICBjcmVhdGVBbmFseXRpY3NKc1JvdXRlKGNhY2hlTmFtZSksXG4gICAgY3JlYXRlR3RhZ0pzUm91dGUoY2FjaGVOYW1lKSxcbiAgICAuLi5jcmVhdGVDb2xsZWN0Um91dGVzKHF1ZXVlKSxcbiAgXTtcblxuICBjb25zdCByb3V0ZXIgPSBuZXcgUm91dGVyKCk7XG4gIGZvciAoY29uc3Qgcm91dGUgb2Ygcm91dGVzKSB7XG4gICAgcm91dGVyLnJlZ2lzdGVyUm91dGUocm91dGUpO1xuICB9XG5cbiAgc2VsZi5hZGRFdmVudExpc3RlbmVyKCdmZXRjaCcsIChldnQpID0+IHtcbiAgICBjb25zdCByZXNwb25zZVByb21pc2UgPSByb3V0ZXIuaGFuZGxlUmVxdWVzdChldnQpO1xuICAgIGlmIChyZXNwb25zZVByb21pc2UpIHtcbiAgICAgIGV2dC5yZXNwb25kV2l0aChyZXNwb25zZVByb21pc2UpO1xuICAgIH1cbiAgfSk7XG59O1xuXG5leHBvcnQge1xuICBpbml0aWFsaXplLFxufTtcbiIsIi8qXG4gQ29weXJpZ2h0IDIwMTcgR29vZ2xlIEluYy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcblxuICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcblxuIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuKi9cblxuaW1wb3J0ICcuLi9fdmVyc2lvbi5tanMnO1xuXG5leHBvcnQgY29uc3QgUVVFVUVfTkFNRSA9ICd3b3JrYm94LWdvb2dsZS1hbmFseXRpY3MnO1xuZXhwb3J0IGNvbnN0IE1BWF9SRVRFTlRJT05fVElNRSA9IDEwMDAgKiA2MCAqIDYwICogNDg7IC8vIFR3byBkYXlzXG5leHBvcnQgY29uc3QgR09PR0xFX0FOQUxZVElDU19IT1NUID0gJ3d3dy5nb29nbGUtYW5hbHl0aWNzLmNvbSc7XG5leHBvcnQgY29uc3QgR1RNX0hPU1QgPSAnd3d3Lmdvb2dsZXRhZ21hbmFnZXIuY29tJztcbmV4cG9ydCBjb25zdCBBTkFMWVRJQ1NfSlNfUEFUSCA9ICcvYW5hbHl0aWNzLmpzJztcbmV4cG9ydCBjb25zdCBHVEFHX0pTX1BBVEggPSAnL2d0YWcvanMnO1xuZXhwb3J0IGNvbnN0IENPTExFQ1RfUEFUSCA9ICcvY29sbGVjdCc7XG4iXSwibmFtZXMiOlsid29ya2JveCIsInYiLCJlIiwib3B0aW9ucyIsImNhY2hlTmFtZSIsImNhY2hlTmFtZXMiLCJnZXRHb29nbGVBbmFseXRpY3NOYW1lIiwicXVldWUiLCJRdWV1ZSIsImNvbmZpZyIsInVybCIsInRpbWVzdGFtcCIsInJlcXVlc3RJbml0IiwicGFyYW1zIiwiYm9keSIsInBheWxvYWQiLCJibG9iIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJyZWFkZXIiLCJGaWxlUmVhZGVyIiwib25sb2FkZW5kIiwicmVzdWx0Iiwib25lcnJvciIsImVycm9yIiwicmVhZEFzVGV4dCIsImdldFRleHRGcm9tQmxvYiIsIlVSTFNlYXJjaFBhcmFtcyIsIlVSTCIsInNlYXJjaFBhcmFtcyIsInF1ZXVlVGltZSIsIkRhdGUiLCJub3ciLCJzZXQiLCJwYXJhbWV0ZXJPdmVycmlkZXMiLCJwYXJhbSIsIk9iamVjdCIsImtleXMiLCJ2YWx1ZSIsImhpdEZpbHRlciIsImNhbGwiLCJ0b1N0cmluZyIsIm1ldGhvZCIsIm1vZGUiLCJjcmVkZW50aWFscyIsImhlYWRlcnMiLCJjcmVhdGVSZXF1ZXN0V2lsbFJlcGxheUNhbGxiYWNrIiwicm91dGVzIiwiaGFuZGxlciIsIk5ldHdvcmtGaXJzdCIsIlJvdXRlIiwiaG9zdG5hbWUiLCJwYXRobmFtZSIsImNyZWF0ZUFuYWx5dGljc0pzUm91dGUiLCJjcmVhdGVHdGFnSnNSb3V0ZSIsIm1hdGNoIiwiTmV0d29ya09ubHkiLCJRdWV1ZVBsdWdpbiIsImNyZWF0ZUNvbGxlY3RSb3V0ZXMiLCJyb3V0ZXIiLCJSb3V0ZXIiLCJyb3V0ZSIsInJlZ2lzdGVyUm91dGUiLCJhZGRFdmVudExpc3RlbmVyIiwiZXZ0IiwicmVzcG9uc2VQcm9taXNlIiwiaGFuZGxlUmVxdWVzdCIsInJlc3BvbmRXaXRoIl0sIm1hcHBpbmdzIjoia0dBQUEsU0FBU0EsUUFBUUMsRUFBRSwwQ0FBMEMsRUFBRyxNQUFNQyx3QkN1S25ELEVBQUNDLGNBQ1pDLEVBQVlDLGFBQVdDLHVCQUF1QkgsRUFBUUMsV0FFdERHLEVBQVEsSUFBSUMsUUN6Sk0sNkNBQ1Esb0NEMkNPQyxDQUFBQSw2Q0FDaEMsV0FBT0MsSUFBQ0EsRUFBREMsVUFBTUEsRUFBTkMsWUFBaUJBLFFBR3pCQyxLQUNBRCxFQUFZRSxLQUFNLE9BQ2RDLE9BMUJhQyxDQUFBQSxHQUNoQixJQUFJQyxRQUFRLENBQUNDLEVBQVNDLFdBQ3JCQyxFQUFTLElBQUlDLGFBQ1pDLFVBQVksS0FBTUosRUFBUUUsRUFBT0csV0FDakNDLFFBQVUsS0FBTUwsRUFBT0MsRUFBT0ssVUFDOUJDLFdBQVdWLEtBcUJNVyxDQUFnQmYsRUFBWUUsUUFDekMsSUFBSWMsZ0JBQWdCYixVQUVwQixJQUFJYyxJQUFJbkIsR0FBS29CLG1CQUlsQkMsRUFBWUMsS0FBS0MsTUFBUXRCLE9BQ3hCdUIsSUFBSSxLQUFNSCxHQUVidEIsRUFBTzBCLHVCQUNKLE1BQU1DLEtBQVNDLE9BQU9DLEtBQUs3QixFQUFPMEIsb0JBQXFCLE9BQ3BESSxFQUFROUIsRUFBTzBCLG1CQUFtQkMsS0FDakNGLElBQUlFLEVBQU9HLEdBSVUsbUJBQXJCOUIsRUFBTytCLGFBQ1RBLFVBQVVDLEtBQUssS0FBTTVCLEtBR2xCQyxLQUFPRCxFQUFPNkIsYUFDZEMsT0FBUyxTQUNUQyxLQUFPLFNBQ1BDLFlBQWMsU0FDZEMsUUFBVSxxQ0FDVnBDLElBQU8scUdBZ0ZFcUMsQ0FBZ0M1QyxNQUlqRDZDLEdBbER3QjVDLENBQUFBLFVBR3hCNkMsRUFBVSxJQUFJQyxnQkFBYzlDLFVBQUFBLFdBRTNCLElBQUkrQyxRQUpHLEVBQUV6QyxJQUFBQSxLQzdHbUIsNkJENkdWQSxFQUFJMEMsVUMzR0Usa0JENEczQjFDLEVBQUkyQyxTQUdnQkosRUFBUyxRQThDL0JLLENBQXVCbEQsR0FuQ0FBLENBQUFBLFVBR25CNkMsRUFBVSxJQUFJQyxnQkFBYzlDLFVBQUFBLFdBRTNCLElBQUkrQyxRQUpHLEVBQUV6QyxJQUFBQSxLQzVITSw2QkQ0SEdBLEVBQUkwQyxVQzFISCxhRDJIdEIxQyxFQUFJMkMsU0FHZ0JKLEVBQVMsUUErQi9CTSxDQUFrQm5ELE1BMUVPRyxDQUFBQSxVQUNyQmlELEVBQVEsRUFBRTlDLElBQUFBLEtDdkZtQiw2QkR1RlZBLEVBQUkwQyxVQ25GSCxhRG9GdEIxQyxFQUFJMkMsU0FFRkosRUFBVSxJQUFJUSx3QkFDUixJQUFJQyxjQUFZbkQsYUFJMUIsSUFBSTRDLFFBQU1LLEVBQU9QLEVBQVMsT0FDMUIsSUFBSUUsUUFBTUssRUFBT1AsRUFBUyxVQWlFdkJVLENBQW9CcEQsSUFHbkJxRCxFQUFTLElBQUlDLGFBQ2QsTUFBTUMsS0FBU2QsSUFDWGUsY0FBY0QsUUFHbEJFLGlCQUFpQixRQUFVQyxVQUN4QkMsRUFBa0JOLEVBQU9PLGNBQWNGLEdBQ3pDQyxLQUNFRSxZQUFZRiJ9"}